<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VoFo Music</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:Inter}
.hidden{display:none}
nav{display:flex;justify-content:space-between;padding:20px}
nav span{margin-left:20px;cursor:pointer}
nav span.active{color:#c5a367}
.hero{text-align:center;padding:60px}
.container{max-width:700px;margin:auto}
.track{display:flex;gap:15px;padding:15px;background:#141414;border-radius:8px;margin-bottom:10px;cursor:pointer}
.track img{width:50px;height:50px;border-radius:4px;object-fit:cover}
.player{position:fixed;bottom:0;width:100%;background:#000;padding:15px;display:flex;gap:15px;align-items:center}
.player img{width:60px;height:60px}
.controls button{background:none;border:none;color:#c5a367;font-size:18px;cursor:pointer}
.like.active{color:red}
</style>
</head>

<body>

<div id="auth">
    <h2 align="center">VoFo Login</h2>
    <input id="user" placeholder="Username"><br><br>
    <input id="pass" type="password" placeholder="Password"><br><br>
    <button onclick="login()">Login</button>
</div>

<div id="app" class="hidden">

<nav>
    <strong>VoFo</strong>
    <div>
        <span id="tabExplore" class="active" onclick="show('explore')">Explore</span>
        <span id="tabLibrary" onclick="show('library')">Library</span>
        <span onclick="logout()">Logout</span>
    </div>
</nav>

<div id="explore" class="hero">
    <input id="q" placeholder="Search music">
    <button onclick="search()">Search</button>
    <div id="results" class="container"></div>
</div>

<div id="library" class="hero hidden">
    <h2>Liked Songs</h2>
    <div id="libraryResults" class="container"></div>
</div>

</div>

<div id="player" class="player hidden">
    <img id="thumb">
    <div style="flex:1">
        <div id="title"></div>
        <div id="artist"></div>
    </div>
    <div class="controls">
        <button onclick="prev()">‚èÆ</button>
        <button onclick="shuffle()">üîÄ</button>
        <button onclick="toggle()">‚ñ∂</button>
        <button onclick="next()">‚è≠</button>
        <button onclick="repeat()">üîÅ</button>
        <span id="like" class="like" onclick="toggleLike()">‚ù§</span>
    </div>
</div>

<script>
const audio=new Audio()
let list=[],index=0,liked=[],shuffleOn=false,repeatOn=false

async function login(){
    const r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({username:user.value,password:pass.value})})
    if((await r.json()).success){
        auth.classList.add('hidden')
        app.classList.remove('hidden')
        loadLibrary()
    }
}

async function logout(){await fetch('/api/auth/logout');location.reload()}

function show(t){
    explore.classList.toggle('hidden',t!=='explore')
    library.classList.toggle('hidden',t!=='library')
    tabExplore.classList.toggle('active',t==='explore')
    tabLibrary.classList.toggle('active',t==='library')
    if(t==='library')loadLibrary()
}

async function search(){
    const r=await fetch('/api/search?q='+q.value)
    render(await r.json(),results)
}

async function loadLibrary(){
    const r=await fetch('/api/library')
    liked=await r.json()
    render(liked,libraryResults)
}

function render(arr,el){
    el.innerHTML=''
    arr.forEach((s,i)=>{
        const d=document.createElement('div')
        d.className='track'
        d.innerHTML=`<img src="${s.thumbnail}"><div><div>${s.title}</div><div>${s.artist}</div></div>`
        d.onclick=()=>play(arr,i)
        el.appendChild(d)
    })
}

async function play(arr,i){
    list=arr;index=i
    const s=arr[i]
    player.classList.remove('hidden')
    title.innerText=s.title;artist.innerText=s.artist;thumb.src=s.thumbnail
    const r=await fetch('/api/play',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:s.id})})
    audio.src=(await r.json()).stream_url
    audio.play()
}

audio.onended=()=>setTimeout(()=>repeatOn?play(list,index):next(),1000)

function next(){index=shuffleOn?Math.random()*list.length|0:(index+1)%list.length;play(list,index)}
function prev(){index=(index-1+list.length)%list.length;play(list,index)}
function toggle(){audio.paused?audio.play():audio.pause()}
function shuffle(){shuffleOn=!shuffleOn}
function repeat(){repeatOn=!repeatOn}

async function toggleLike(){
    const s=list[index]
    await fetch('/api/like',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(s)})
    loadLibrary()
}
</script>

</body>
</html>
